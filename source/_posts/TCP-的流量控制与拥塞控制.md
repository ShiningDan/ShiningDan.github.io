---
title: TCP 的流量控制与拥塞控制
date: 2017-03-15 20:34:22
categories: coding
tags:
  - TCP
---

本文是 TCP 的可靠传输原理、流量控制与拥塞控制的笔记。

<!--more-->

## TCP 的可靠传输的工作原理

### 停止等待协议

停止等待就是每发完一个分组，就停止发送，等待对方的确认，在收到确认后再发送下一个分组。

如果超过一段时间没有收到确认，就认为刚才发送的分组丢失了，因而重传刚发发送的分组，这就叫做**超时重传**

超时重传时间应当比数据在分组传输的平均往返时间更长一点。

**使用停止等待协议的信道利用率很低。**

上述这种可靠传输协议被称为**自动重传请求 ARQ**。

### 流水线传输

当使用流水线传输的时候，可以获得很高的信道利用率。

流水线传输使用**连续 ARQ 协议**和**滑动窗口协议**。

![](http://img.blog.csdn.net/20130801215525546?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvc2ljb2ZpZWxk/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast)

**窗口单位是字节，不是报文段。**

首先，位于发送窗口内的分组都可以连续的发送出去，而不需要等待对方的确认。当所有的分组都发送出去以后，根据**连续 ARQ 协议**规定，发送方每接收到一个确认，就可以把发送窗口向前移动一个分组的位置。

## TCP 的流量控制

**利用滑动窗口实现流量控制。**

**所谓流量控制就是让发送发送速率不要过快，让接收方来得及接收。利用滑动窗口机制就可以实施流量控制。**

![](http://images.cnitblog.com/blog/153130/201308/12214258-07499554110c4fb08795049dc787c598.png)

原理这就是运用TCP报文段中的窗口大小字段来控制，发送方的发送窗口不可以大于接收方发回的窗口大小。

 从图中可以看出，B进行了三次流量控制。第一次把窗口减少到 rwnd = 300 ，第二次又减到了 rwnd = 100 ，最后减到 rwnd = 0 ，即不允许发送方再发送数据了。这种使发送方暂停发送的状态将持续到主机B重新发出一个新的窗口值为止。B向A发送的三个报文段都设置了 ACK = 1 ，只有在ACK=1时确认号字段才有意义。
    TCP为每一个连接设有一个持续计时器(persistence timer)。只要TCP连接的一方收到对方的零窗口通知，就启动持续计时器。若持续计时器设置的时间到期，就发送一个零窗口控测报文段（携1字节的数据），那么收到这个报文段的一方就重新设置持续计时器。
    
## TCP 的拥塞控制












