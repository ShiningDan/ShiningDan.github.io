---
title: 博客性能优化之热门数据缓存
date: 2017-05-27 21:13:30
categories: coding
tags:
  - Redis
  - MongoDB
---

 Redis 是基于内存来存储数据的，所以 Redis 对数据读取的速度远远大于使用硬盘来读取数据的速度，因此经常被用作缓存。除此之外，Redis 还经常使用在应用排行榜、网站访问统计、数据过期处理、商品秒杀（队列机制）等地方。在本博客中，针对访问量比较大的数据，如首页信息，以及热门的文章，设计了 Redis 缓存方案。
 
 <!--more-->
 
## 安装 Redis

安装 Redis 的流程还是很简单的，具体的流程可以参考官网介绍 [Redis Quick Start](https://redis.io/topics/quickstart)。在下载并且编译完成 Redis 以后，在虚拟机上部署 Redis 时，我配置了 [redis.conf](http://download.redis.io/redis-stable/redis.conf) 中的几个参数，其中有：

```
daemonize yes      // 设置 Redis 后台启动
port 7200          // 设置 Redis 的启动端口
```

当然，除此以外，还可以配置连接 Redis 的用户验证密码，日志的输出记录等。因为 Redis 的数据都是存储在内存中的，所以会比较消耗内存资源，所以在配置文件中，也可以注意以下设置 Redis 可以使用的最大存储内存。具体很多的参数，有需要的同学，可以参考下面文章进行设置：[redis.conf配置及说明](http://www.cnblogs.com/tinywan/p/6008622.html)

在我的环境中，为了方便启动 Redis，还使用 `alias` 重新定义了 Redis 的启动命令：

```
alias startredis="/root/redis/redis-3.2.9/src/redis-server /root/redis/redis-3.2.9/redis.conf"
alias redis-cli="/root/redis/redis-3.2.9/src/redis-cli"
```

## Redis 相关库

Redis 官方提供了多种语言连接的库，其中 JS 的库可以在 [NodeRedis](http://redis.js.org/) 这里找到说明。官方的 `redis` 库是基于回调函数来进行异步处理的，我们也可以使用 [bluebird](https://github.com/petkaantonov/bluebird) 来包装该库，来实现基于 Promise 处理的能力。

```
var redis = require('redis');
bluebird.promisifyAll(redis.RedisClient.prototype);
bluebird.promisifyAll(redis.Multi.prototype);
```

```
// We expect a value 'foo': 'bar' to be present
// So instead of writing client.get('foo', cb); you have to write:
return client.getAsync('foo').then(function(res) {
    console.log(res); // => 'bar'
});

// Using multi with promises looks like:

return client.multi().get('foo').execAsync().then(function(res) {
    console.log(res); // => 'bar'
});
```

使用 `bluebird` 来包装异步调用的方法在 [redis GitHub](https://github.com/NodeRedis/node_redis) 上也可以找到。

除此以外，还需要注意一点，在使用 Redis 的库的时候，如果有多个查询，可以使用 `multi()` + `execAsync()` 函数来进行一次处理。
 
## 同步 Mongodb 数据到 Redis

## 设置同步周期
 
## 参考
 
* [Redis API](https://redis.io/commands)
 








